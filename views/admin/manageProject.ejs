<%- include("../partials/adminheader.ejs") %> <%- include("./menu/sidebar.ejs")
%>

<div class="content">
  <%- include("./menu/navbar.ejs") %>

  <div class="container-fluid pt-4 px-4">
    <!-- Page Header and Search -->
    <div
      class="d-flex flex-column flex-md-row justify-content-between align-items-center mb-3"
    >
      <h4 class="mb-3 mb-md-0">Manage Projects</h4>

      <div class="d-flex flex-wrap gap-2">
        <!-- Search Form -->
        <form class="d-flex" method="GET" action="/admin/manage-project">
          <input
            type="text"
            name="search"
            value="<%= search %>"
            class="form-control me-2"
            placeholder="Search projects..."
          />
          <button class="btn btn-outline-success" type="submit">Search</button>
        </form>

        <!-- Add Project Button -->
        <a href="/admin/add-project" class="btn btn-success">
          <i class="fas fa-plus-circle me-1"></i> Add Project
        </a>
      </div>
    </div>
    <!-- Flash Message -->

    <!-- Project Table -->
    <div class="bg-light p-4 rounded">
      <div class="table-responsive">
        <table class="table table-hover align-middle">
          <thead class="table-success">
            <tr>
              <th>#</th>
              <th>Title</th>
              <th>Location</th>
              <th>Date</th>
              <th>Ongoing</th>
              <th>Created</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <% if (projects.length > 0) { %> <% projects.forEach((project,
            index) => { %>
            <tr>
              <td><%= (currentPage - 1) * 10 + index + 1 %></td>
              <td><%= project.title %></td>
              <td><%= project.location || 'â€”' %></td>
              <td>
                <%= new Date(project.date).toLocaleDateString("en-US", { month:
                "short", day: "numeric", year: "numeric" }) %>
              </td>
              <td>
                <% if (project.ongoing) { %>
                <span class="badge bg-success">Yes</span>
                <% } else { %>
                <span class="badge bg-secondary">No</span>
                <% } %>
              </td>
              <td>
                <%= new Date(project.created_at).toLocaleDateString("en-US") %>
              </td>
              <td>
                <a
                  href="/admin/view-project/<%= project.id %>"
                  class="btn btn-sm btn-info"
                >
                  <i class="fas fa-eye"></i>
                </a>
                <a
                  href="/admin/edit-project/<%= project.id %>"
                  class="btn btn-sm btn-warning"
                >
                  <i class="fas fa-edit"></i>
                </a>
                <form
                  action="/admin/delete-project/<%= project.id %>"
                  method="POST"
                  class="d-inline"
                  onsubmit="return confirm('Are you sure you want to delete <%= project.title %>?')"
                >
                  <button class="btn btn-sm btn-danger" type="submit">
                    <i class="fas fa-trash-alt"></i>
                  </button>
                </form>
              </td>
            </tr>
            <% }) %> <% } else { %>
            <tr>
              <td colspan="7" class="text-center text-muted">
                No results found.
              </td>
            </tr>
            <% } %>
          </tbody>
        </table>
      </div>

      <!-- Pagination -->
      <% if (totalPages > 1) { %>
      <nav class="mt-3">
        <ul class="pagination justify-content-center">
          <% for (let i = 1; i <= totalPages; i++) { %>
          <li class="page-item <%= currentPage === i ? 'active' : '' %>">
            <a class="page-link" href="?page=<%= i %>&search=<%= search %>"
              ><%= i %></a
            >
          </li>
          <% } %>
        </ul>
      </nav>
      <% } %>
    </div>
  </div>

  <%- include("../partials/adminfooter.ejs") %>
</div>
