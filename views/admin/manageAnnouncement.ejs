<%- include("../partials/adminheader.ejs") %>
<%- include("./menu/sidebar.ejs") %>

<div class="content">
  <%- include("./menu/navbar.ejs") %>

  <div class="container-fluid pt-4 px-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h4 class="mb-0">Manage Announcements</h4>
      <form class="d-flex" method="GET" action="/admin/manage-announcement">
        <input type="text" name="search" value="<%= search || '' %>" class="form-control me-2" placeholder="Search..." />
        <button class="btn btn-outline-success" type="submit">Search</button>
      </form>
      
    </div>

    <% if (message) { %>
      <div class="alert alert-success"><%= message %></div>
    <% } %>

    <div class="bg-light rounded p-4">
      <table class="table table-hover align-middle">
        <thead class="thead-dark">
          <tr>
            <th>#</th>
            <th>Title</th>
            <th>Date</th>
            <th>Location</th>
            <th>Status</th>
            <th>Post</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <% if (announcements.length > 0) { %>
            <% announcements.forEach((a, i) => { %>
              <tr>
                <td><%= (currentPage - 1) * pageSize + i + 1 %></td>
                <td><%= a.title %></td>
                <td><%= new Date(a.event_date).toLocaleDateString() %> @ <%= a.event_time %></td>
                <td><%= a.location %></td>
                <td>
                  <span class="badge <%= a.status ? 'bg-success' : 'bg-secondary' %>">
                    <%= a.status ? 'Posted' : 'Draft' %>
                  </span>
                </td>
                <td>
                  <form method="POST" action="/admin/manage-announcements/<%= a.id %>">
                    <button class="btn btn-sm <%= a.status ? 'btn-outline-secondary' : 'btn-outline-success' %>">
                      <%= a.status ? 'Unpost' : 'Post' %>
                    </button>
                  </form>
                </td>
                <td>
                  <a href="/admin/announcements/view/<%= a.id %>" class="btn btn-sm btn-info"><i class="fas fa-eye"></i></a>
                  <a href="/admin/announcements/edit/<%= a.id %>" class="btn btn-sm btn-warning"><i class="fas fa-edit"></i></a>
                  <form method="POST" action="/admin/announcements/delete/<%= a.id %>" class="d-inline" onsubmit="return confirm('Delete this announcement?')">
                    <button class="btn btn-sm btn-danger"><i class="fas fa-trash-alt"></i></button>
                  </form>
                </td>
              </tr>
            <% }) %>
          <% } else { %>
            <tr>
              <td colspan="7" class="text-center text-muted">No announcements found.</td>
            </tr>
          <% } %>
        </tbody>
      </table>

      <% if (totalPages > 1) { %>
        <nav class="mt-4">
          <ul class="pagination justify-content-center">
            <% for (let i = 1; i <= totalPages; i++) { %>
              <li class="page-item <%= currentPage === i ? 'active' : '' %>">
                <a class="page-link" href="?page=<%= i %>&search=<%= search || '' %>"><%= i %></a>
              </li>
            <% } %>
          </ul>
        </nav>
      <% } %>
    </div>
  </div>

  <%- include("../partials/adminfooter.ejs") %>
