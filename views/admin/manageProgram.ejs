<%- include("../partials/adminheader.ejs") %>

<!-- Sidebar Start -->
<%- include("./menu/sidebar.ejs") %>
<!-- Sidebar End -->

<!-- Content Start -->
<div class="content">
  <!-- Navbar Start -->
  <%- include("./menu/navbar.ejs") %>

  <!-- Page Heading & Add Button -->
  <div class="container-fluid pt-4 px-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h4 class="mb-0">Manage Programs</h4>
      <a href="/admin/add-program" class="btn btn-success">
        <i class="fas fa-plus-circle mr-2"></i> Add New Program
      </a>
    </div>

    <!-- Search Form -->
    <form class="mb-4" method="GET" action="">
      <div class="input-group">
        <input
          type="text"
          name="q"
          value="<%= query || '' %>"
          class="form-control"
          placeholder="Search programs by title..."
        />
        <button class="btn btn-outline-primary" type="submit">
          <i class="fas fa-search"></i> Search
        </button>
      </div>
    </form>

    <!-- Flash Message -->
    <% if (message) { %>
      <div class="alert alert-success"><%= message %></div>
    <% } %>

    <!-- Programs Table -->
    <div class="bg-light rounded p-4">
      <div class="table-responsive">
        <table class="table table-striped table-hover align-middle">
          <thead class="thead-dark">
            <tr>
              <th>#</th>
              <th>Title</th>
              <th>Location</th>
              <th>Audience</th>
              <th>Frequency</th>
              <th>Created</th>
              <th class="text-center">Actions</th>
            </tr>
          </thead>
          <tbody>
            <% if (programs && programs.length > 0) { %>
              <% programs.forEach((program, index) => { %>
                <tr>
                  <td><%= (page - 1) * 10 + index + 1 %></td>
                  <td><%= program.title %></td>
                  <td><%= program.location || 'N/A' %></td>
                  <td><%= program.target_audience || '—' %></td>
                  <td><%= program.frequency || '—' %></td>
                  <td><%= new Date(program.created_at).toLocaleDateString() %></td>
                  <td class="text-center">
                    <a href="/admin/view-program/<%= program.id %>" class="btn btn-sm btn-info me-1">
                      <i class="fas fa-eye"></i>
                    </a>
                    <a href="/admin/edit-program/<%= program.id %>" class="btn btn-sm btn-warning me-1">
                      <i class="fas fa-edit"></i>
                    </a>

                    <!-- Button trigger modal -->
                    <button
                      type="button"
                      class="btn btn-sm btn-danger"
                      data-toggle="modal"
                      data-target="#deleteModal<%= program.id %>"
                    >
                      <i class="fas fa-trash-alt"></i>
                    </button>
                  </td>
                </tr>

                <!-- Delete Confirmation Modal -->
                <div class="modal fade" id="deleteModal<%= program.id %>" tabindex="-1" role="dialog" aria-labelledby="deleteModalLabel<%= program.id %>" aria-hidden="true">
                  <div class="modal-dialog modal-dialog-centered" role="document">
                    <div class="modal-content border-0">
                      <div class="modal-header bg-danger text-white">
                        <h5 class="modal-title" id="deleteModalLabel<%= program.id %>">Confirm Delete</h5>
                        <button type="button" class="close bg-danger border-0 text-white" data-dismiss="modal" aria-label="Close">
                          <span aria-hidden="true">&times;</span>
                        </button>
                      </div>
                      <div class="modal-body">
                        Are you sure you want to delete "<strong><%= program.title %></strong>"?
                      </div>
                      <div class="modal-footer">
                        <form method="POST" action="/admin/delete-program/<%= program.id %>">
                          <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                          <button type="submit" class="btn btn-danger">Delete</button>
                        </form>
                      </div>
                    </div>
                  </div>
                </div>

              <% }) %>
            <% } else { %>
              <tr>
                <td colspan="7" class="text-center text-muted">No programs found.</td>
              </tr>
            <% } %>
          </tbody>
        </table>
      </div>

      <!-- Pagination -->
      <nav>
  <ul class="pagination justify-content-center">
    <% if (page > 1) { %>
      <li class="page-item">
        <a class="page-link" href="?page=<%= page - 1 %>&q=<%= encodeURIComponent(query) %>">Previous</a>
      </li>
    <% } %>

    <% for (let i = 1; i <= totalPages; i++) { %>
      <li class="page-item <%= page === i ? 'active' : '' %>">
        <a class="page-link" href="?page=<%= i %>&q=<%= encodeURIComponent(query) %>"><%= i %></a>
      </li>
    <% } %>

    <% if (page < totalPages) { %>
      <li class="page-item">
        <a class="page-link" href="?page=<%= page + 1 %>&q=<%= encodeURIComponent(query) %>">Next</a>
      </li>
    <% } %>
  </ul>
</nav>


    </div>
  </div>


  <script>
  // Wait for DOM to load
  document.addEventListener('DOMContentLoaded', function () {
    const alert = document.querySelector('.alert');
    if (alert) {
      // Remove the alert after 3 seconds (3000ms)
      setTimeout(() => {
        alert.style.transition = 'opacity 0.5s ease';
        alert.style.opacity = '0';
        // Optionally remove from DOM after fade out
        setTimeout(() => alert.remove(), 500);
      }, 3000);
    }
  });
</script>

  <!-- Footer -->
  <%- include("../partials/adminfooter.ejs") %>

